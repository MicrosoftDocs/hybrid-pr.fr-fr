---
title: Modèle Kubernetes à haute disponibilité avec Azure et Azure Stack Hub
description: Découvrez comment une solution de cluster Kubernetes fournit une haute disponibilité en utilisant Azure et Azure Stack Hub.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/09/2020
ms.locfileid: "96912000"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="9e134-103">Modèle de cluster Kubernetes à haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="9e134-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="9e134-104">Cet article explique comment architecturer et utiliser une infrastructure Kubernetes à haute disponibilité en utilisant le moteur Azure Kubernetes Service (AKS) sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="9e134-105">Ce scénario est courant pour les organisations ayant des charges de travail critiques dans des environnements hautement confidentiels et réglementés.</span><span class="sxs-lookup"><span data-stu-id="9e134-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="9e134-106">Organisations dans des domaines tels que la finance, la défense et l’administration.</span><span class="sxs-lookup"><span data-stu-id="9e134-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="9e134-107">Contexte et problème</span><span class="sxs-lookup"><span data-stu-id="9e134-107">Context and problem</span></span>

<span data-ttu-id="9e134-108">De nombreuses organisations développent des solutions cloud natives qui tirent parti de services et de technologies de pointe, comme Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="9e134-109">Bien qu’Azure fournisse des centres de donnés dans la plupart des régions du monde, il y a parfois des cas d’utilisation et des scénarios particuliers où des applications critiques doivent s’exécuter à un endroit particulier.</span><span class="sxs-lookup"><span data-stu-id="9e134-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="9e134-110">Éléments à prendre en compte :</span><span class="sxs-lookup"><span data-stu-id="9e134-110">Considerations include:</span></span>

- <span data-ttu-id="9e134-111">Sensibilité de la localisation</span><span class="sxs-lookup"><span data-stu-id="9e134-111">Location sensitivity</span></span>
- <span data-ttu-id="9e134-112">Latence entre l’application et les systèmes locaux</span><span class="sxs-lookup"><span data-stu-id="9e134-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="9e134-113">Conservation de la bande passante</span><span class="sxs-lookup"><span data-stu-id="9e134-113">Bandwidth conservation</span></span>
- <span data-ttu-id="9e134-114">Connectivité</span><span class="sxs-lookup"><span data-stu-id="9e134-114">Connectivity</span></span>
- <span data-ttu-id="9e134-115">Obligations réglementaires ou statutaires</span><span class="sxs-lookup"><span data-stu-id="9e134-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="9e134-116">Azure, en combinaison avec Azure Stack Hub, répond à la plupart de ces préoccupations.</span><span class="sxs-lookup"><span data-stu-id="9e134-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="9e134-117">Vous trouverez ci-dessous un large éventail d’options, de décisions et de considérations à prendre en compte pour une implémentation réussie de Kubernetes s’exécutant sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="9e134-118">Solution</span><span class="sxs-lookup"><span data-stu-id="9e134-118">Solution</span></span>

<span data-ttu-id="9e134-119">Ce modèle part du principe que nous devons respecter un ensemble de contraintes strictes.</span><span class="sxs-lookup"><span data-stu-id="9e134-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="9e134-120">L’application doit s’exécuter en local et aucunes données personnelles ne doivent atteindre les services cloud publics.</span><span class="sxs-lookup"><span data-stu-id="9e134-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="9e134-121">Les données de supervision et les données autres que les informations d'identification personnelle peuvent être envoyées à Azure et traitées ici.</span><span class="sxs-lookup"><span data-stu-id="9e134-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="9e134-122">Des services externes, comme un registre de conteneurs, sont accessibles mais peuvent être filtrés via un pare-feu ou un serveur proxy.</span><span class="sxs-lookup"><span data-stu-id="9e134-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="9e134-123">L’exemple d’application présenté ici (basé sur [Atelier Azure Kubernetes Service](/learn/modules/aks-workshop/)) est conçu pour utiliser des solutions natives Kubernetes chaque fois que c’est possible.</span><span class="sxs-lookup"><span data-stu-id="9e134-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="9e134-124">Cette conception évite les situations de monopole du fournisseur, au lieu d’utiliser les services natifs de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="9e134-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="9e134-125">Par exemple, l’application utilise un back-end de base de données MongoDB auto-hébergé au lieu d’un service PaaS ou d’un service de base de données externe.</span><span class="sxs-lookup"><span data-stu-id="9e134-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="9e134-126">[![Modèle d’application - Hybride](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="9e134-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="9e134-127">Le diagramme ci-dessus illustre l’architecture d’application de l’exemple d’application s’exécutant sur Kubernetes, sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="9e134-128">L’application est constituée de plusieurs composants :</span><span class="sxs-lookup"><span data-stu-id="9e134-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="9e134-129">Un cluster Kubernetes basé sur le moteur AKS sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="9e134-130">[cert-manager](https://www.jetstack.io/cert-manager/), qui fournit une suite d’outils pour la gestion des certificats dans Kubernetes, utilisée pour demander automatiquement des certificats auprès de Let's Encrypt.</span><span class="sxs-lookup"><span data-stu-id="9e134-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="9e134-131">Un espace de noms Kubernetes qui contient les composants de l’application pour le front-end (ratings-web), l’API (ratings-api) et la base de données (ratings-mongodb).</span><span class="sxs-lookup"><span data-stu-id="9e134-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="9e134-132">Le contrôleur d’entrée qui route le trafic HTTP/HTTPS vers les points de terminaison au sein du cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="9e134-133">L’exemple d’application est utilisé pour illustrer l’architecture de l’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="9e134-134">Tous les composants sont des exemples.</span><span class="sxs-lookup"><span data-stu-id="9e134-134">All components are examples.</span></span> <span data-ttu-id="9e134-135">L’architecture contient un seul déploiement d’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="9e134-136">Pour obtenir une haute disponibilité, nous allons effectuer le déploiement au moins deux fois sur deux instances Azure Stack Hub différentes, qui peuvent s’exécuter au même emplacement ou dans deux sites (ou plus) différents :</span><span class="sxs-lookup"><span data-stu-id="9e134-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Architecture de l'infrastructure](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="9e134-138">Les services, comme Container Registry, Azure Monitor et d’autres, sont hébergés en dehors d’Azure Stack Hub dans Azure ou localement.</span><span class="sxs-lookup"><span data-stu-id="9e134-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="9e134-139">Cette conception hybride protège la solution contre les pannes d’une instance Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="9e134-140">Components</span><span class="sxs-lookup"><span data-stu-id="9e134-140">Components</span></span>

<span data-ttu-id="9e134-141">L’architecture globale est constituée des composants suivants :</span><span class="sxs-lookup"><span data-stu-id="9e134-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="9e134-142">**Azure Stack Hub** est une extension d’Azure qui peut exécuter des charges de travail dans un environnement local en fournissant des services Azure dans votre centre de données.</span><span class="sxs-lookup"><span data-stu-id="9e134-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="9e134-143">Pour plus d’informations, consultez [Vue d’ensemble d’Azure Stack Hub](/azure-stack/operator/azure-stack-overview).</span><span class="sxs-lookup"><span data-stu-id="9e134-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="9e134-144">**Moteur Azure Kubernetes Service (Moteur AKS)** est le moteur qui se trouve derrière l’offre du service Kubernetes managé, Azure Kubernetes Service (AKS), disponible aujourd’hui dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9e134-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="9e134-145">Pour Azure Stack Hub, le moteur AKS nous permet de déployer, de mettre à l’échelle et de mettre à niveau des clusters Kubernetes entièrement fonctionnels et automanagés en utilisant les fonctionnalités IaaS d’Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="9e134-146">Pour plus d’informations, consultez [Vue d’ensemble du moteur AKS](https://github.com/Azure/aks-engine).</span><span class="sxs-lookup"><span data-stu-id="9e134-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="9e134-147">Pour plus d’informations sur les différences entre le moteur AKS sur Azure et le moteur AKS sur Azure Stack Hub, consultez [Problèmes connus et limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations).</span><span class="sxs-lookup"><span data-stu-id="9e134-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="9e134-148">**Le réseau virtuel Azure (VNet)** est utilisé pour fournir l’infrastructure réseau sur chaque Azure Stack Hub pour les machines virtuelles hébergeant l’infrastructure de cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="9e134-149">**Azure Load Balancer** est utilisé pour le point de terminaison de l’API Kubernetes et le contrôleur d’entrée Nginx.</span><span class="sxs-lookup"><span data-stu-id="9e134-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="9e134-150">L’équilibreur de charge route le trafic externe (par exemple Internet) vers les nœuds et les machines virtuelles offrant un service spécifique.</span><span class="sxs-lookup"><span data-stu-id="9e134-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="9e134-151">**Azure Container Registry (ACR)** est utilisé pour stocker les images Docker privées et les charts Helm qui sont déployés sur le cluster.</span><span class="sxs-lookup"><span data-stu-id="9e134-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="9e134-152">Le moteur AKS peut s’authentifier auprès de Container Registry en utilisant une identité Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9e134-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="9e134-153">Kubernetes ne nécessite pas ACR.</span><span class="sxs-lookup"><span data-stu-id="9e134-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="9e134-154">Vous pouvez utiliser d’autres registres de conteneurs, tels que Docker Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="9e134-155">**Azure Repos** est un ensemble d’outils de gestion de versions que vous pouvez utiliser pour gérer votre code.</span><span class="sxs-lookup"><span data-stu-id="9e134-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="9e134-156">Vous pouvez également utiliser GitHub ou d’autres dépôts Git.</span><span class="sxs-lookup"><span data-stu-id="9e134-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="9e134-157">Pour plus d’informations, consultez [Vue d’ensemble d’Azure Repos](/azure/devops/repos/get-started/what-is-repos).</span><span class="sxs-lookup"><span data-stu-id="9e134-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="9e134-158">**Azure Pipelines** fait partie d'Azure DevOps Services, et effectue des builds, des tests et des déploiements automatisés.</span><span class="sxs-lookup"><span data-stu-id="9e134-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="9e134-159">Vous pouvez également utiliser des solutions CI/CD tierces telles que Jenkins.</span><span class="sxs-lookup"><span data-stu-id="9e134-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="9e134-160">Pour plus d’informations, consultez [Vue d’ensemble d’Azure Pipelines](/azure/devops/pipelines/get-started/what-is-azure-pipelines).</span><span class="sxs-lookup"><span data-stu-id="9e134-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="9e134-161">**Azure Monitor** recueille et stocke les métriques et journaux d’activité, notamment les métriques de plateforme pour les services Azure dans les données de télémétrie d’application et de solution.</span><span class="sxs-lookup"><span data-stu-id="9e134-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="9e134-162">Utilisez ces données pour superviser l’application, définir des alertes et des tableaux de bord et effectuer une analyse de la cause racine des échecs.</span><span class="sxs-lookup"><span data-stu-id="9e134-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="9e134-163">Azure Monitor s’intègre à Kubernetes pour collecter des métriques auprès des contrôleurs, des nœuds et des conteneurs ainsi que les journaux d’activité des conteneurs et les journaux d’activité des nœuds master.</span><span class="sxs-lookup"><span data-stu-id="9e134-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="9e134-164">Pour plus d’informations, consultez [Vue d’ensemble d’Azure Monitor](/azure/azure-monitor/overview).</span><span class="sxs-lookup"><span data-stu-id="9e134-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="9e134-165">**Azure Traffic Manager** est un équilibreur de charge du trafic DNS qui vous permet de distribuer le trafic de façon optimale aux services entre différentes régions Azure ou entre différents déploiements Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="9e134-166">Traffic Manager offre également une haute disponibilité et une haute réactivité.</span><span class="sxs-lookup"><span data-stu-id="9e134-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="9e134-167">Les points de terminaison d’application doivent être accessibles à partir de l’extérieur.</span><span class="sxs-lookup"><span data-stu-id="9e134-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="9e134-168">D’autres solutions locales sont également disponibles.</span><span class="sxs-lookup"><span data-stu-id="9e134-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="9e134-169">Le **contrôleur d’entrée Kubernetes** expose les routes HTTP(S) aux services dans un cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="9e134-170">Nginx ou n’importe quel contrôleur d’entrée approprié peut être utilisé à cette fin.</span><span class="sxs-lookup"><span data-stu-id="9e134-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="9e134-171">**Helm** est un gestionnaire de package pour le déploiement de Kubernetes, qui fournit un moyen de regrouper différents objets Kubernetes, comme les déploiements, les services et les secrets, dans un même « chart ».</span><span class="sxs-lookup"><span data-stu-id="9e134-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="9e134-172">Vous pouvez publier, déployer, contrôler la gestion de versions et mettre à jour un objet du chart.</span><span class="sxs-lookup"><span data-stu-id="9e134-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="9e134-173">Azure Container Registry peut être utilisé comme référentiel pour stocker les charts Helm empaquetés.</span><span class="sxs-lookup"><span data-stu-id="9e134-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="9e134-174">Remarques relatives à la conception</span><span class="sxs-lookup"><span data-stu-id="9e134-174">Design considerations</span></span>

<span data-ttu-id="9e134-175">Ce modèle suit quelques considérations générales expliquées plus en détails dans les sections suivantes de cet article :</span><span class="sxs-lookup"><span data-stu-id="9e134-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="9e134-176">L’application utilise des solutions natives Kubernetes afin d’éviter les situations de monopole des fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="9e134-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="9e134-177">L’application utilise une architecture de microservices.</span><span class="sxs-lookup"><span data-stu-id="9e134-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="9e134-178">Azure Stack Hub n’a pas besoin de trafic entrant, mais il autorise la connectivité Internet sortante.</span><span class="sxs-lookup"><span data-stu-id="9e134-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="9e134-179">Ces pratiques recommandées s’appliquent également aux charges de travail et aux scénarios réels.</span><span class="sxs-lookup"><span data-stu-id="9e134-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="9e134-180">Considérations relatives à l’extensibilité</span><span class="sxs-lookup"><span data-stu-id="9e134-180">Scalability considerations</span></span>

<span data-ttu-id="9e134-181">La scalabilité est importante pour fournir aux utilisateurs un accès cohérent, fiable et performant à l’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="9e134-182">L’exemple de scénario couvre la scalabilité sur plusieurs couches de la pile d’applications.</span><span class="sxs-lookup"><span data-stu-id="9e134-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="9e134-183">Voici une vue d’ensemble des différentes couches :</span><span class="sxs-lookup"><span data-stu-id="9e134-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="9e134-184">Niveau architecture</span><span class="sxs-lookup"><span data-stu-id="9e134-184">Architecture level</span></span> | <span data-ttu-id="9e134-185">Éléments affectés</span><span class="sxs-lookup"><span data-stu-id="9e134-185">Affects</span></span> | <span data-ttu-id="9e134-186">Comment faire ?</span><span class="sxs-lookup"><span data-stu-id="9e134-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="9e134-187">Application</span><span class="sxs-lookup"><span data-stu-id="9e134-187">Application</span></span> | <span data-ttu-id="9e134-188">Application</span><span class="sxs-lookup"><span data-stu-id="9e134-188">Application</span></span> | <span data-ttu-id="9e134-189">Mise à l’échelle horizontale en fonction du nombre de Pods/Réplicas/Instances de conteneur\*</span><span class="sxs-lookup"><span data-stu-id="9e134-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="9e134-190">Cluster</span><span class="sxs-lookup"><span data-stu-id="9e134-190">Cluster</span></span> | <span data-ttu-id="9e134-191">Cluster Kubernetes</span><span class="sxs-lookup"><span data-stu-id="9e134-191">Kubernetes cluster</span></span> | <span data-ttu-id="9e134-192">Le nombre de nœuds (entre 1 et 50), les tailles des références SKU de machine virtuelle et les pools de nœuds (le moteur AKS sur Azure Stack Hub prend actuellement en charge un seul pool de nœuds) ; utilisation de la commande de mise à l’échelle du moteur AKS (manuelle)</span><span class="sxs-lookup"><span data-stu-id="9e134-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="9e134-193">Infrastructure</span><span class="sxs-lookup"><span data-stu-id="9e134-193">Infrastructure</span></span> | <span data-ttu-id="9e134-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-194">Azure Stack Hub</span></span> | <span data-ttu-id="9e134-195">Nombre de nœuds, capacité et unités d’échelle au sein d’un déploiement Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="9e134-196">\* Utilisation du HPA (Horizontal Pod Autoscaler) de Kubernetes ; mise à l’échelle automatique basée sur des métriques ou mise à l’échelle verticale en redimensionnant les instances de conteneur (processeur/mémoire).</span><span class="sxs-lookup"><span data-stu-id="9e134-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="9e134-197">**Azure Stack Hub (niveau infrastructure)**</span><span class="sxs-lookup"><span data-stu-id="9e134-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="9e134-198">L’infrastructure Azure Stack Hub est la base de cette implémentation, car Azure Stack Hub s’exécute sur du matériel physique dans un centre de données.</span><span class="sxs-lookup"><span data-stu-id="9e134-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="9e134-199">Quand vous sélectionnez le matériel de votre hub, vous devez faire des choix pour le processeur, la densité de la mémoire, la configuration du stockage et le nombre de serveurs.</span><span class="sxs-lookup"><span data-stu-id="9e134-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="9e134-200">Pour plus d’informations sur la scalabilité d’Azure Stack Hub, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="9e134-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="9e134-201">Vue d’ensemble de la planification de la capacité pour Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="9e134-202">Ajouter des nœuds d’unité d’échelle dans Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="9e134-203">**Cluster Kubernetes (niveau cluster)**</span><span class="sxs-lookup"><span data-stu-id="9e134-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="9e134-204">Le cluster Kubernetes lui-même est constitué de composants IaaS Azure (Stack) incluant des ressources de calcul, de stockage et réseau.</span><span class="sxs-lookup"><span data-stu-id="9e134-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="9e134-205">Les solutions Kubernetes impliquent des nœuds master et worker, qui sont déployés en tant que machines virtuelles dans Azure (et Azure Stack Hub).</span><span class="sxs-lookup"><span data-stu-id="9e134-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="9e134-206">Les [nœuds de plan de contrôle](/azure/aks/concepts-clusters-workloads#control-plane) (master) fournissent les services Kubernetes de base et l’orchestration des charges de travail d’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="9e134-207">Les [nœuds worker](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) exécutent vos charges de travail d’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="9e134-208">Lors de la sélection des tailles de machines virtuelles pour le déploiement initial, plusieurs éléments sont à prendre en compte :</span><span class="sxs-lookup"><span data-stu-id="9e134-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="9e134-209">**Coût** : lors de la planification de vos nœuds worker, gardez à l’esprit le coût global par machine virtuelle que vous allez supporter.</span><span class="sxs-lookup"><span data-stu-id="9e134-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="9e134-210">Par exemple, si vos charges de travail d’application nécessitent des ressources limitées, vous devez prévoir de déployer des machines virtuelles d’une taille inférieure.</span><span class="sxs-lookup"><span data-stu-id="9e134-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="9e134-211">Azure Stack Hub, comme Azure, est normalement facturé en fonction de la consommation : un dimensionnement approprié des machines virtuelles pour les rôles Kubernetes est donc crucial pour optimiser les coûts de la consommation.</span><span class="sxs-lookup"><span data-stu-id="9e134-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="9e134-212">**Scalabilité** : la scalabilité du cluster est obtenue en effectuant un scale-in et un scale-out du nombre de nœuds master et worker, ou en ajoutant des pools de nœuds supplémentaires (non disponibles à ce jour sur Azure Stack Hub).</span><span class="sxs-lookup"><span data-stu-id="9e134-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="9e134-213">La mise à l’échelle du cluster peut être effectuée en fonction des données de performances, collectées avec Container Insights (Azure Monitor + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="9e134-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="9e134-214">Si votre application a besoin de plus (ou de moins) de ressources, vous pouvez effectuer un scale-out (ou un scale-in) horizontal de vos nœuds actuels (entre 1 et 50 nœuds).</span><span class="sxs-lookup"><span data-stu-id="9e134-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="9e134-215">Si vous avez besoin de plus de 50 nœuds, vous pouvez créer un cluster supplémentaire dans un abonnement distinct.</span><span class="sxs-lookup"><span data-stu-id="9e134-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="9e134-216">Vous ne pouvez effectuer un scale-up vertical des machines virtuelles réelles vers une autre taille de machine virtuelle sans redéployer le cluster.</span><span class="sxs-lookup"><span data-stu-id="9e134-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="9e134-217">La mise à l’échelle se fait manuellement en utilisant la machine virtuelle d’assistance du moteur AKS qui a été utilisée pour le déploiement initial du cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="9e134-218">Pour plus d’informations, consultez [Mise à l’échelle des clusters Kubernetes](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md).</span><span class="sxs-lookup"><span data-stu-id="9e134-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="9e134-219">**Quotas** : tenez compte des [quotas](/azure-stack/operator/azure-stack-quota-types) que vous avez configurés lors de la planification d’un déploiement AKS sur votre Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="9e134-220">Vérifiez que chaque [abonnement](/azure-stack/operator/service-plan-offer-subscription-overview) dispose des plans appropriés et des quotas configurés.</span><span class="sxs-lookup"><span data-stu-id="9e134-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="9e134-221">L’abonnement va devoir prendre en charge la quantité de calcul, de stockage et d’autres services nécessaires à vos clusters au fur et à mesure de leur scale-out.</span><span class="sxs-lookup"><span data-stu-id="9e134-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="9e134-222">**Charges de travail d’application** : reportez-vous à la section [Concepts des clusters et des charges de travail](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) dans le document des concepts de base de Kubernetes pour Azure Kubernetes Service.</span><span class="sxs-lookup"><span data-stu-id="9e134-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="9e134-223">Cet article vous aidera à déterminer la taille de machine virtuelle appropriée en fonction des besoins en calcul et en mémoire de votre application.</span><span class="sxs-lookup"><span data-stu-id="9e134-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="9e134-224">**Application (niveau application)**</span><span class="sxs-lookup"><span data-stu-id="9e134-224">**Application (application level)**</span></span>

<span data-ttu-id="9e134-225">Sur la couche application, nous utilisons Kubernetes [HPA (Horizontal Pod Autoscaler)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span><span class="sxs-lookup"><span data-stu-id="9e134-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="9e134-226">HPA peut augmenter ou diminuer le nombre de réplicas (Pod/Instances de conteneur) dans notre déploiement en fonction de différentes métriques (comme l’utilisation du processeur).</span><span class="sxs-lookup"><span data-stu-id="9e134-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="9e134-227">Une autre option est de mettre à l’échelle verticalement les instances de conteneur.</span><span class="sxs-lookup"><span data-stu-id="9e134-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="9e134-228">Pour cela, vous pouvez modifier la quantité de processeurs et de mémoire demandée et disponible pour un déploiement spécifique.</span><span class="sxs-lookup"><span data-stu-id="9e134-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="9e134-229">Pour plus d’informations, consultez [Gestion des ressources pour les conteneurs](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) sur kubernetes.io.</span><span class="sxs-lookup"><span data-stu-id="9e134-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="9e134-230">Considérations sur le réseau et la connectivité</span><span class="sxs-lookup"><span data-stu-id="9e134-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="9e134-231">Le réseau et la connectivité affectent également les trois couches mentionnées précédemment pour Kubernetes sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="9e134-232">Le tableau suivant montre les couches et les services qu’elles contiennent :</span><span class="sxs-lookup"><span data-stu-id="9e134-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="9e134-233">Couche</span><span class="sxs-lookup"><span data-stu-id="9e134-233">Layer</span></span> | <span data-ttu-id="9e134-234">Éléments affectés</span><span class="sxs-lookup"><span data-stu-id="9e134-234">Affects</span></span> | <span data-ttu-id="9e134-235">Quoi ?</span><span class="sxs-lookup"><span data-stu-id="9e134-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="9e134-236">Application</span><span class="sxs-lookup"><span data-stu-id="9e134-236">Application</span></span> | <span data-ttu-id="9e134-237">Application</span><span class="sxs-lookup"><span data-stu-id="9e134-237">Application</span></span> | <span data-ttu-id="9e134-238">Comment l’application est-elle accessible ?</span><span class="sxs-lookup"><span data-stu-id="9e134-238">How is the application accessible?</span></span> <span data-ttu-id="9e134-239">Sera-t-elle exposée à Internet ?</span><span class="sxs-lookup"><span data-stu-id="9e134-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="9e134-240">Cluster</span><span class="sxs-lookup"><span data-stu-id="9e134-240">Cluster</span></span> | <span data-ttu-id="9e134-241">Cluster Kubernetes</span><span class="sxs-lookup"><span data-stu-id="9e134-241">Kubernetes cluster</span></span> | <span data-ttu-id="9e134-242">API Kubernetes, machine virtuelle du moteur AKS, extraction d’images de conteneur (sortie), envoi des données de supervision et télémétrie (sortie)</span><span class="sxs-lookup"><span data-stu-id="9e134-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="9e134-243">Infrastructure</span><span class="sxs-lookup"><span data-stu-id="9e134-243">Infrastructure</span></span> | <span data-ttu-id="9e134-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-244">Azure Stack Hub</span></span> | <span data-ttu-id="9e134-245">Accessibilité des points de terminaison de gestion Azure Stack Hub, comme le portail et les points de terminaison Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="9e134-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="9e134-246">**Application**</span><span class="sxs-lookup"><span data-stu-id="9e134-246">**Application**</span></span>

<span data-ttu-id="9e134-247">Pour la couche application, la considération la plus importante est de savoir si l’application est exposée et accessible à partir d’Internet.</span><span class="sxs-lookup"><span data-stu-id="9e134-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="9e134-248">Du point de vue de Kubernetes, l’accessibilité Internet signifie l’exposition d’un déploiement ou d’un pod en utilisant un service Kubernetes ou un contrôleur d’entrée.</span><span class="sxs-lookup"><span data-stu-id="9e134-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="9e134-249">Nous vous recommandons d’utiliser des contrôleurs d’entrée pour exposer les services Kubernetes, car le nombre d’adresses IP publiques de front-end sur Azure Stack Hub est limité à 5.</span><span class="sxs-lookup"><span data-stu-id="9e134-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="9e134-250">Cette conception limite également le nombre de services Kubernetes (avec le type LoadBalancer) à 5, ce qui est trop petit pour beaucoup de déploiements.</span><span class="sxs-lookup"><span data-stu-id="9e134-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="9e134-251">Pour plus d’informations, consultez la [documentation du moteur AKS](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips).</span><span class="sxs-lookup"><span data-stu-id="9e134-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="9e134-252">L’exposition d’une application avec une adresse IP publique via un équilibreur de charge ou un contrôleur d’entrée ne signifie pas que l’application est maintenant accessible via Internet.</span><span class="sxs-lookup"><span data-stu-id="9e134-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="9e134-253">Azure Stack Hub peut avoir une adresse IP publique qui n’est visible que sur l’intranet local : toutes les adresses IP publiques ne sont pas réellement accessibles sur Internet.</span><span class="sxs-lookup"><span data-stu-id="9e134-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="9e134-254">Le bloc précédent considère le trafic entrant vers l’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="9e134-255">Pour la réussite d’un déploiement Kubernetes, il faut également considérer le trafic sortant.</span><span class="sxs-lookup"><span data-stu-id="9e134-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="9e134-256">Voici quelques cas d’utilisation qui nécessitent un trafic sortant :</span><span class="sxs-lookup"><span data-stu-id="9e134-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="9e134-257">Extraction d’images de conteneur stockées sur DockerHub ou Azure Container Registry</span><span class="sxs-lookup"><span data-stu-id="9e134-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="9e134-258">Récupération de charts Helm</span><span class="sxs-lookup"><span data-stu-id="9e134-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="9e134-259">Émission de données Application Insights (ou d’autres données de supervision)</span><span class="sxs-lookup"><span data-stu-id="9e134-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="9e134-260">Certains environnements d’entreprise peuvent nécessiter l’utilisation de serveurs proxy _transparents_ ou _non transparents_.</span><span class="sxs-lookup"><span data-stu-id="9e134-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="9e134-261">Ces serveurs nécessitent une configuration spécifique sur les différents composants de notre cluster.</span><span class="sxs-lookup"><span data-stu-id="9e134-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="9e134-262">La documentation du moteur AKS contient différentes informations détaillées sur la prise en charge des proxys réseau.</span><span class="sxs-lookup"><span data-stu-id="9e134-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="9e134-263">Pour plus d’informations, consultez [Moteur AKS et serveurs proxy](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span><span class="sxs-lookup"><span data-stu-id="9e134-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="9e134-264">Enfin, un trafic entre les clusters doit circuler entre les instances Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="9e134-265">L’exemple de déploiement consiste en clusters Kubernetes individuels exécutés sur des instances Azure Stack Hub individuelles.</span><span class="sxs-lookup"><span data-stu-id="9e134-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="9e134-266">Le trafic entre ces instances, par exemple le trafic de réplication entre deux bases de données, est du « trafic externe ».</span><span class="sxs-lookup"><span data-stu-id="9e134-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="9e134-267">Le trafic externe doit être routé à travers un VPN de site à site ou des adresses IP publiques Azure Stack Hub pour connecter Kubernetes sur deux instances Azure Stack Hub :</span><span class="sxs-lookup"><span data-stu-id="9e134-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![trafic inter-cluster et intra-cluster](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="9e134-269">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="9e134-269">**Cluster**</span></span>  

<span data-ttu-id="9e134-270">Le cluster Kubernetes n’a pas nécessairement besoin d’être accessible via Internet.</span><span class="sxs-lookup"><span data-stu-id="9e134-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="9e134-271">La partie pertinente est l’API Kubernetes utilisée pour faire fonctionner un cluster, par exemple en utilisant `kubectl`.</span><span class="sxs-lookup"><span data-stu-id="9e134-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="9e134-272">Le point de terminaison de l’API Kubernetes doit être accessible à tous les utilisateurs qui font fonctionner le cluster, ou qui déploient des applications et des services sur celui-ci.</span><span class="sxs-lookup"><span data-stu-id="9e134-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="9e134-273">Ce sujet est traité plus en détails du point de vue de DevOps dans la section [Considérations sur le déploiement (CI/CD)](#deployment-cicd-considerations) ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="9e134-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="9e134-274">Au niveau du cluster, quelques éléments sont également à prendre en compte concernant le trafic sortant :</span><span class="sxs-lookup"><span data-stu-id="9e134-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="9e134-275">Mises à jour des nœuds (pour Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="9e134-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="9e134-276">Données de supervision (envoyées à Azure Log Analytics)</span><span class="sxs-lookup"><span data-stu-id="9e134-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="9e134-277">Autres agents nécessitant un trafic sortant (spécifique à l’environnement de chaque utilisateur effectuant un déploiement)</span><span class="sxs-lookup"><span data-stu-id="9e134-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="9e134-278">Avant de déployer votre cluster Kubernetes en utilisant le moteur AKS, planifiez la conception de finale du réseau.</span><span class="sxs-lookup"><span data-stu-id="9e134-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="9e134-279">Au lieu de créer un réseau virtuel dédié, il peut être plus efficace de déployer un cluster dans un réseau existant.</span><span class="sxs-lookup"><span data-stu-id="9e134-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="9e134-280">Par exemple, vous pouvez tirer parti d’une connexion VPN de site à site existante déjà configurée dans votre environnement Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="9e134-281">**Infrastructure**</span><span class="sxs-lookup"><span data-stu-id="9e134-281">**Infrastructure**</span></span>  

<span data-ttu-id="9e134-282">L’infrastructure fait référence à l’accès aux points de terminaison de gestion d’Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="9e134-283">Les points de terminaison incluent les portails de locataire et d’administration ainsi que les points de terminaison d’administration et de locataire d’Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="9e134-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="9e134-284">Ces points de terminaison sont nécessaires pour utiliser Azure Stack Hub et ses services de base.</span><span class="sxs-lookup"><span data-stu-id="9e134-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="9e134-285">Considérations relatives au stockage et aux données</span><span class="sxs-lookup"><span data-stu-id="9e134-285">Data and storage considerations</span></span>

<span data-ttu-id="9e134-286">Deux instances de notre application seront déployées sur deux clusters Kubernetes individuels, sur deux instances Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="9e134-287">Cette conception nous oblige à réfléchir à la façon de répliquer et de synchroniser les données entre elles.</span><span class="sxs-lookup"><span data-stu-id="9e134-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="9e134-288">Avec Azure, nous avons la possibilité de répliquer le stockage entre plusieurs régions et zones au sein du cloud.</span><span class="sxs-lookup"><span data-stu-id="9e134-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="9e134-289">Avec Azure Stack Hub, il n’y a actuellement pas de moyen natif de répliquer le stockage entre deux instances Azure Stack Hub différentes : elles forment deux clouds indépendants sans aucun moyen de les gérer comme un tout.</span><span class="sxs-lookup"><span data-stu-id="9e134-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="9e134-290">La planification de la résilience des applications exécutées sur Azure Stack Hub vous oblige à prendre en compte cette indépendance dans la conception et le déploiement de votre application.</span><span class="sxs-lookup"><span data-stu-id="9e134-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="9e134-291">Dans la plupart des cas, la réplication du stockage n’est pas nécessaire pour une application résiliente et à haute disponibilité déployée sur AKS.</span><span class="sxs-lookup"><span data-stu-id="9e134-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="9e134-292">Vous devez cependant envisager un stockage indépendant par instance Azure Stack Hub dans la conception de votre application.</span><span class="sxs-lookup"><span data-stu-id="9e134-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="9e134-293">Si cette conception est un problème ou un frein pour le déploiement de la solution sur Azure Stack Hub, des solutions possibles existent chez des partenaires de Microsoft, qui fournissent des attachements de stockage.</span><span class="sxs-lookup"><span data-stu-id="9e134-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="9e134-294">Les attachements de stockage fournissent une solution de réplication du stockage entre plusieurs instances Azure Stack Hub et Azure.</span><span class="sxs-lookup"><span data-stu-id="9e134-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="9e134-295">Pour plus d’informations, consultez les [Solutions de partenaires](#partner-solutions).</span><span class="sxs-lookup"><span data-stu-id="9e134-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="9e134-296">Dans notre architecture, ces couches ont été considérées :</span><span class="sxs-lookup"><span data-stu-id="9e134-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="9e134-297">**Configuration**</span><span class="sxs-lookup"><span data-stu-id="9e134-297">**Configuration**</span></span>

<span data-ttu-id="9e134-298">La configuration comprend la configuration d’Azure Stack Hub, du moteur AKS et du cluster Kubernetes lui-même.</span><span class="sxs-lookup"><span data-stu-id="9e134-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="9e134-299">La configuration doit être automatisée autant que possible et stockée comme « Infrastructure en tant que code » dans un système de gestion de versions basé sur Git, comme Azure DevOps ou GitHub.</span><span class="sxs-lookup"><span data-stu-id="9e134-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="9e134-300">Ces paramètres ne peuvent pas être synchronisés facilement entre plusieurs déploiements.</span><span class="sxs-lookup"><span data-stu-id="9e134-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="9e134-301">Par conséquent, nous vous recommandons de stocker et d’appliquer la configuration depuis l’extérieur et d’utiliser le pipeline DevOps.</span><span class="sxs-lookup"><span data-stu-id="9e134-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="9e134-302">**Application**</span><span class="sxs-lookup"><span data-stu-id="9e134-302">**Application**</span></span>

<span data-ttu-id="9e134-303">L’application doit être stockée dans un dépôt Git.</span><span class="sxs-lookup"><span data-stu-id="9e134-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="9e134-304">Chaque fois qu’il y a un nouveau déploiement, des modifications apportées à l’application ou une reprise d’activité, elle peut ainsi être déployée facilement en utilisant Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="9e134-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="9e134-305">**Données**</span><span class="sxs-lookup"><span data-stu-id="9e134-305">**Data**</span></span>

<span data-ttu-id="9e134-306">La question des données est ce qu’il y a de plus important à considérer dans la plupart des conceptions d’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="9e134-307">Les données d’application doivent rester synchronisées entre les différentes instances de l’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="9e134-308">Les données ont également besoin d’une stratégie de sauvegarde et de reprise d’activité en cas de panne.</span><span class="sxs-lookup"><span data-stu-id="9e134-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="9e134-309">Réussir cette conception dépend fortement des choix technologiques.</span><span class="sxs-lookup"><span data-stu-id="9e134-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="9e134-310">Voici quelques exemples de solutions permettant d’implémenter une base de données avec une haute disponibilité sur Azure Stack Hub :</span><span class="sxs-lookup"><span data-stu-id="9e134-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="9e134-311">Déployer un groupe de disponibilité SQL Server 2016 sur Azure et Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="9e134-312">Déployer une solution MongoDB hautement disponible sur Azure et Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="9e134-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="9e134-313">Les considérations à prendre en compte lors de l’utilisation de données se trouvant à plusieurs endroits sont encore plus complexes pour une solution à haute disponibilité et à haute résilience.</span><span class="sxs-lookup"><span data-stu-id="9e134-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="9e134-314">Considérez les aspects suivants :</span><span class="sxs-lookup"><span data-stu-id="9e134-314">Consider:</span></span>

- <span data-ttu-id="9e134-315">Latence et connectivité réseau entre les instances Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="9e134-316">Disponibilité des identités pour les services et les autorisations.</span><span class="sxs-lookup"><span data-stu-id="9e134-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="9e134-317">Chaque instance Azure Stack Hub s’intègre à un annuaire externe.</span><span class="sxs-lookup"><span data-stu-id="9e134-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="9e134-318">Lors du déploiement, vous choisissez d’utiliser Azure Active Directory (Azure AD) ou les services de fédération Active Directory (AD FS).</span><span class="sxs-lookup"><span data-stu-id="9e134-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="9e134-319">Par conséquent, il est possible d’utiliser une seule identité qui peut interagir avec plusieurs instances Azure Stack Hub indépendantes.</span><span class="sxs-lookup"><span data-stu-id="9e134-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="9e134-320">Continuité d’activité et reprise d’activité</span><span class="sxs-lookup"><span data-stu-id="9e134-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="9e134-321">La continuité d’activité et la reprise d’activité (BCDR, Business Continuity and Disaster Recovery) sont un sujet important à la fois dans Azure Stack Hub et dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9e134-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="9e134-322">La principale différence est que dans Azure Stack Hub, l’opérateur doit gérer l’ensemble du processus BCDR.</span><span class="sxs-lookup"><span data-stu-id="9e134-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="9e134-323">Dans Azure, les composants de BCDR sont gérés automatiquement par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9e134-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="9e134-324">BCDR affecte les mêmes éléments mentionnés dans la section précédente [Considérations relatives au stockage et aux données](#data-and-storage-considerations) :</span><span class="sxs-lookup"><span data-stu-id="9e134-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="9e134-325">Infrastructure / Configuration</span><span class="sxs-lookup"><span data-stu-id="9e134-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="9e134-326">Disponibilité de l’application</span><span class="sxs-lookup"><span data-stu-id="9e134-326">Application Availability</span></span>
- <span data-ttu-id="9e134-327">Données d'application</span><span class="sxs-lookup"><span data-stu-id="9e134-327">Application Data</span></span>

<span data-ttu-id="9e134-328">Comme mentionné dans la section précédente, ces éléments sont de la responsabilité de l’opérateur Azure Stack Hub et peuvent varier d’une organisation à l’autre.</span><span class="sxs-lookup"><span data-stu-id="9e134-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="9e134-329">Planifiez le BCDR en fonction de vos outils et processus disponibles.</span><span class="sxs-lookup"><span data-stu-id="9e134-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="9e134-330">**Infrastructure et configuration**</span><span class="sxs-lookup"><span data-stu-id="9e134-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="9e134-331">Cette section traite de l’infrastructure physique et logique, et de la configuration d’Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="9e134-332">Elle couvre les actions dans les espaces du locataire et de l’administrateur.</span><span class="sxs-lookup"><span data-stu-id="9e134-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="9e134-333">L’opérateur (ou l’administrateur) Azure Stack Hub est responsable de la maintenance des instances Azure Stack Hub,</span><span class="sxs-lookup"><span data-stu-id="9e134-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="9e134-334">y compris les composants comme le réseau, le stockage, l’identité et d’autres éléments qui n’entrent pas dans le cadre de cet article.</span><span class="sxs-lookup"><span data-stu-id="9e134-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="9e134-335">Pour plus d’informations sur les spécificités des opérations Azure Stack Hub, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="9e134-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="9e134-336">Récupérer des données dans Azure Stack Hub avec le service Infrastructure Backup</span><span class="sxs-lookup"><span data-stu-id="9e134-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="9e134-337">Activer la sauvegarde d’Azure Stack Hub à partir du portail administrateur</span><span class="sxs-lookup"><span data-stu-id="9e134-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="9e134-338">Récupérer des données suite à une perte catastrophique</span><span class="sxs-lookup"><span data-stu-id="9e134-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="9e134-339">Meilleures pratiques concernant le service de sauvegarde de l’infrastructure</span><span class="sxs-lookup"><span data-stu-id="9e134-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="9e134-340">Azure Stack Hub est la plateforme et la structure fabric sur lesquelles les applications Kubernetes seront déployées.</span><span class="sxs-lookup"><span data-stu-id="9e134-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="9e134-341">Le propriétaire de l’application Kubernetes sera un utilisateur d’Azure Stack Hub, avec un accès accordé pour déployer l’infrastructure d’application nécessaire pour la solution.</span><span class="sxs-lookup"><span data-stu-id="9e134-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="9e134-342">Dans ce cas, l’infrastructure d’application correspond au cluster Kubernetes, déployé en utilisant le moteur AKS, et aux services environnants.</span><span class="sxs-lookup"><span data-stu-id="9e134-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="9e134-343">Ces composants seront déployés dans Azure Stack Hub, contraints par une offre Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="9e134-344">Vérifiez que l’offre acceptée par le propriétaire de l’application Kubernetes a une capacité suffisante (exprimée en quotas Azure Stack Hub) pour déployer l’ensemble de la solution.</span><span class="sxs-lookup"><span data-stu-id="9e134-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="9e134-345">Comme nous l’avons recommandé dans la section précédente, le déploiement de l’application doit être automatisé en utilisant « Infrastructure en tant que code » et des pipelines de déploiement comme Azure Pipelines d’Azure DevOps.</span><span class="sxs-lookup"><span data-stu-id="9e134-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="9e134-346">Pour plus d’informations sur les offres et les quotas Azure Stack Hub, consultez [Vue d’ensemble des services, plans, offres et abonnements Azure Stack Hub](/azure-stack/operator/service-plan-offer-subscription-overview).</span><span class="sxs-lookup"><span data-stu-id="9e134-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="9e134-347">Il est important d’enregistrer et de stocker de façon sécurisée la configuration du moteur AKS, y compris ses sorties.</span><span class="sxs-lookup"><span data-stu-id="9e134-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="9e134-348">Ces fichiers contiennent des informations confidentielles utilisées pour accéder au cluster Kubernetes : ils doivent donc être protégés d’une exposition à des non-administrateurs.</span><span class="sxs-lookup"><span data-stu-id="9e134-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="9e134-349">**Disponibilité de l’application**</span><span class="sxs-lookup"><span data-stu-id="9e134-349">**Application availability**</span></span>

<span data-ttu-id="9e134-350">L’application ne doit pas s’appuyer sur les sauvegardes d’une instance déployée.</span><span class="sxs-lookup"><span data-stu-id="9e134-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="9e134-351">Au titre de pratique standard, redéployez complètement l’application en suivant les modèles « Infrastructure en tant que Code ».</span><span class="sxs-lookup"><span data-stu-id="9e134-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="9e134-352">Par exemple, redéployez en utilisant Azure Pipelines d’Azure DevOps.</span><span class="sxs-lookup"><span data-stu-id="9e134-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="9e134-353">La procédure BCDR doit impliquer le redéploiement de l’application sur le même ou sur un autre cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="9e134-354">**Données d’application**</span><span class="sxs-lookup"><span data-stu-id="9e134-354">**Application data**</span></span>

<span data-ttu-id="9e134-355">Les données d’application sont la partie critique de la réduction des pertes de données.</span><span class="sxs-lookup"><span data-stu-id="9e134-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="9e134-356">Dans la section précédente, les techniques de réplication et de synchronisation des données entre deux ou plusieurs instances de l’application ont été décrites.</span><span class="sxs-lookup"><span data-stu-id="9e134-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="9e134-357">En fonction de l’infrastructure de base de données (MySQL, MongoDB, MSSQL ou autres) utilisée pour stocker les données, vous pouvez choisir parmi différentes techniques de sauvegarde et de disponibilité de la base de données.</span><span class="sxs-lookup"><span data-stu-id="9e134-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="9e134-358">Pour garantir l’intégrité, il est recommandé d’utiliser un des moyens suivants :</span><span class="sxs-lookup"><span data-stu-id="9e134-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="9e134-359">Une solution de sauvegarde native pour la base de données spécifique.</span><span class="sxs-lookup"><span data-stu-id="9e134-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="9e134-360">Une solution de sauvegarde qui prend officiellement en charge la sauvegarde et la récupération du type de base de données utilisé par votre application.</span><span class="sxs-lookup"><span data-stu-id="9e134-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9e134-361">Ne stockez pas vos données de sauvegarde sur la l’instance Azure Stack Hub où se trouvent vos données d’application.</span><span class="sxs-lookup"><span data-stu-id="9e134-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="9e134-362">Une panne totale de l’instance Azure Stack Hub compromettrait également vos sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="9e134-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="9e134-363">Considérations relatives à la disponibilité</span><span class="sxs-lookup"><span data-stu-id="9e134-363">Availability considerations</span></span>

<span data-ttu-id="9e134-364">Kubernetes sur Azure Stack Hub déployé via le moteur AKS n’est pas un service managé.</span><span class="sxs-lookup"><span data-stu-id="9e134-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="9e134-365">C’est un déploiement et une configuration automatisés d’un cluster Kubernetes utilisant Azure IaaS (Infrastructure-as-a-Service).</span><span class="sxs-lookup"><span data-stu-id="9e134-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="9e134-366">À ce titre, il offre la même disponibilité que l’infrastructure sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="9e134-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="9e134-367">L’infrastructure Azure Stack Hub est déjà résiliente aux défaillances et fournit des fonctionnalités comme des groupes à haute disponibilité pour distribuer des composants sur plusieurs [domaines d’erreur et de mise à jour](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="9e134-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="9e134-368">La technologie sous-jacente (clustering de basculement) implique néanmoins toujours un temps d’arrêt pour les machines virtuelles qui se trouvent sur un serveur physique impacté en cas de défaillance matérielle.</span><span class="sxs-lookup"><span data-stu-id="9e134-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="9e134-369">C’est une bonne pratique que de déployer votre cluster Kubernetes de production ainsi que la charge de travail sur deux clusters (ou plus).</span><span class="sxs-lookup"><span data-stu-id="9e134-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="9e134-370">Ces clusters doivent être hébergés dans des endroits ou des centres de données différents, et utiliser des technologies comme Azure Traffic Manager pour router les utilisateurs en fonction du temps de réponse du cluster ou de la zone géographique.</span><span class="sxs-lookup"><span data-stu-id="9e134-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![Utilisation de Traffic Manager pour contrôler les flux de trafic](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="9e134-372">Les clients qui ont un seul cluster Kubernetes se connectent généralement à l’adresse IP du service ou au nom DNS d’une application donnée.</span><span class="sxs-lookup"><span data-stu-id="9e134-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="9e134-373">Dans un déploiement impliquant plusieurs clusters, les clients doivent se connecter à un nom DNS de Traffic Manager qui pointe vers les services/entrées sur chaque cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Utilisation de Traffic Manager pour router vers un cluster local](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="9e134-375">Ce modèle est également une [bonne pratique pour les clusters AKS (managés) dans Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="9e134-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="9e134-376">Le cluster Kubernetes lui-même, déployé via le moteur AKS, doit comprendre au moins trois nœuds master et deux nœuds worker.</span><span class="sxs-lookup"><span data-stu-id="9e134-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="9e134-377">Considérations relatives à l’identité et à la sécurité</span><span class="sxs-lookup"><span data-stu-id="9e134-377">Identity and security considerations</span></span>

<span data-ttu-id="9e134-378">L’identité et la sécurité sont des sujets importants,</span><span class="sxs-lookup"><span data-stu-id="9e134-378">Identity and security are important topics.</span></span> <span data-ttu-id="9e134-379">en particulier quand la solution comprend des instances Azure Stack Hub indépendantes.</span><span class="sxs-lookup"><span data-stu-id="9e134-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="9e134-380">Kubernetes et Azure (y compris Azure Stack Hub) ont tous deux des mécanismes distincts pour le contrôle d’accès en fonction du rôle (RBAC) :</span><span class="sxs-lookup"><span data-stu-id="9e134-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="9e134-381">RBAC Azure contrôle l’accès aux ressources dans Azure (et dans Azure Stack Hub), y compris la possibilité de créer des ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="9e134-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="9e134-382">Ces autorisations peuvent être assignées aux utilisateurs, groupes ou principaux de service.</span><span class="sxs-lookup"><span data-stu-id="9e134-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="9e134-383">(Un principal de service est une identité de sécurité utilisée par les applications.)</span><span class="sxs-lookup"><span data-stu-id="9e134-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="9e134-384">Kubernetes RBAC contrôle les autorisations sur l’API Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="9e134-385">Par exemple, la création de pods et le listage de pods sont des actions qui peuvent être accordées (ou refusées) à un utilisateur au moyen de RBAC.</span><span class="sxs-lookup"><span data-stu-id="9e134-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="9e134-386">Pour affecter des autorisations Kubernetes à des utilisateurs, vous créez des rôles et des liaisons de rôle.</span><span class="sxs-lookup"><span data-stu-id="9e134-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="9e134-387">**Identité Azure Stack Hub et RBAC**</span><span class="sxs-lookup"><span data-stu-id="9e134-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="9e134-388">Azure Stack Hub offre deux choix de fournisseur d’identité.</span><span class="sxs-lookup"><span data-stu-id="9e134-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="9e134-389">Le fournisseur que vous utilisez dépend de l’environnement et de l’exécution dans un environnement connecté ou déconnecté :</span><span class="sxs-lookup"><span data-stu-id="9e134-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="9e134-390">Azure AD : ne peut être utilisé que dans un environnement connecté.</span><span class="sxs-lookup"><span data-stu-id="9e134-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="9e134-391">ADFS vers une forêt Active Directory traditionnelle : peut être utilisé dans un environnement connecté ou déconnecté.</span><span class="sxs-lookup"><span data-stu-id="9e134-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="9e134-392">Le fournisseur d’identité gère les utilisateurs et les groupes, y compris l’authentification et l’autorisation pour accéder aux ressources.</span><span class="sxs-lookup"><span data-stu-id="9e134-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="9e134-393">L’accès peut être accordé à des ressources Azure Stack Hub, comme des abonnements, des groupes de ressources et des ressources individuelles, par exemple des machines virtuelles ou des équilibreurs de charge.</span><span class="sxs-lookup"><span data-stu-id="9e134-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="9e134-394">Pour avoir un modèle d’accès cohérent, vous devez envisager d’utiliser les mêmes groupes (directs ou imbriqués) pour toutes les instances Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="9e134-395">Voici un exemple de configuration :</span><span class="sxs-lookup"><span data-stu-id="9e134-395">Here's a configuration example:</span></span>

![Groupes AAD imbriqués avec Azure Stack Hub](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="9e134-397">L’exemple contient un groupe dédié (utilisant AAD ou ADFS) à des fins spécifiques.</span><span class="sxs-lookup"><span data-stu-id="9e134-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="9e134-398">Par exemple, pour fournir des autorisations de contributeur pour le groupe de ressources qui contient notre infrastructure de clusters Kubernetes sur une instance Azure Stack Hub spécifique (ici, « Seattle K8s Cluster Contributor »).</span><span class="sxs-lookup"><span data-stu-id="9e134-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="9e134-399">Ces groupes sont ensuite imbriqués dans un groupe global qui contient les « sous-groupes » pour chaque Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="9e134-400">Notre exemple d’utilisateur dispose désormais des autorisations « Contributeur » pour les deux groupes de ressources qui contiennent l’ensemble des ressources de l’infrastructure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="9e134-401">L’utilisateur aura accès aux ressources sur les deux instances Azure Stack Hub, car les instances partagent le même fournisseur d’identité.</span><span class="sxs-lookup"><span data-stu-id="9e134-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9e134-402">Ces autorisations affectent seulement Azure Stack Hub et certaines des ressources qui y sont déployées.</span><span class="sxs-lookup"><span data-stu-id="9e134-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="9e134-403">Un utilisateur disposant de ce niveau d’accès peut faire beaucoup de dégâts, mais il ne peut pas accéder aux machines virtuelles IaaS Kubernetes ni à l’API Kubernetes sans accès supplémentaire au déploiement Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="9e134-404">**Identité Kubernetes et RBAC**</span><span class="sxs-lookup"><span data-stu-id="9e134-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="9e134-405">Par défaut, un cluster Kubernetes n’utilise pas le même fournisseur d’identité que l’instance Azure Stack Hub sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="9e134-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="9e134-406">Les machines virtuelles hébergeant le cluster Kubernetes et les nœuds master et worker utilisent la clé SSH spécifiée lors du déploiement du cluster.</span><span class="sxs-lookup"><span data-stu-id="9e134-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="9e134-407">Cette clé SSH est nécessaire pour se connecter à ces nœuds en utilisant SSH.</span><span class="sxs-lookup"><span data-stu-id="9e134-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="9e134-408">L’API Kubernetes (par exemple accessible via `kubectl`) est également protégée par les comptes de service, y compris un compte de service « administrateur de cluster » par défaut.</span><span class="sxs-lookup"><span data-stu-id="9e134-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="9e134-409">Les informations d’identification pour ce compte de service sont initialement stockées dans le fichier `.kube/config` sur vos nœuds master Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="9e134-410">**Gestion des secrets et informations d’identification d’application**</span><span class="sxs-lookup"><span data-stu-id="9e134-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="9e134-411">Pour stocker des secrets, comme des chaînes de connexion ou des informations d’identification de base de données, plusieurs choix sont possibles, notamment :</span><span class="sxs-lookup"><span data-stu-id="9e134-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="9e134-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="9e134-412">Azure Key Vault</span></span>
- <span data-ttu-id="9e134-413">Secrets Kubernetes</span><span class="sxs-lookup"><span data-stu-id="9e134-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="9e134-414">Solutions de tiers, comme HashiCorp Vault (qui s’exécute sur Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="9e134-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="9e134-415">Ne stockez pas les secrets ou les informations d’identification en texte clair dans vos fichiers de configuration, dans votre code d’application ou dans des scripts.</span><span class="sxs-lookup"><span data-stu-id="9e134-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="9e134-416">Ne les stockez pas non plus dans un système de gestion de versions.</span><span class="sxs-lookup"><span data-stu-id="9e134-416">And do not store them in a version control system.</span></span> <span data-ttu-id="9e134-417">Au lieu de cela, l’automatisation du déploiement doit récupérer les secrets en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="9e134-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="9e134-418">Correctifs et mises à jour</span><span class="sxs-lookup"><span data-stu-id="9e134-418">Patch and update</span></span>

<span data-ttu-id="9e134-419">Le processus **Corriger et mettre à jour (PNU, Patch and Update)** dans Azure Kubernetes Service est partiellement automatisé.</span><span class="sxs-lookup"><span data-stu-id="9e134-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="9e134-420">Les mises à niveau des versions de Kubernetes sont déclenchées manuellement, tandis que les mises à jour de sécurité sont appliquées automatiquement.</span><span class="sxs-lookup"><span data-stu-id="9e134-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="9e134-421">Ces mises à jour incluent des correctifs de sécurité ou des mises à jour du noyau du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="9e134-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="9e134-422">AKS ne redémarre pas automatiquement ces nœuds Linux pour terminer le processus de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="9e134-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="9e134-423">Le processus PNU pour un cluster Kubernetes déployé en utilisant le moteur AKS sur Azure Stack Hub n’est pas géré et est de la responsabilité de l’opérateur du cluster.</span><span class="sxs-lookup"><span data-stu-id="9e134-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="9e134-424">Le moteur AKS facilite les deux tâches les plus importantes :</span><span class="sxs-lookup"><span data-stu-id="9e134-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="9e134-425">Mettre à niveau vers une version plus récente de Kubernetes et de l’image du système d’exploitation de base</span><span class="sxs-lookup"><span data-stu-id="9e134-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="9e134-426">Mettre à niveau l’image du système d’exploitation de base uniquement</span><span class="sxs-lookup"><span data-stu-id="9e134-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="9e134-427">Les images de système d’exploitation de base plus récentes contiennent les derniers correctifs de sécurité et les dernières mises à jour du noyau du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="9e134-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="9e134-428">Le mécanisme de [mise à niveau sans assistance](https://wiki.debian.org/UnattendedUpgrades) installe automatiquement les mises à jour de sécurité publiées avant qu’une nouvelle version de l’image du système d’exploitation de base ne soit disponible dans la place de marché Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="9e134-429">La mise à niveau sans assistance est activée par défaut et installe automatiquement les mises à jour de sécurité, mais elle ne redémarre pas les nœuds du cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="9e134-430">Le redémarrage des nœuds peut être automatisé en utilisant le [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured) open source.</span><span class="sxs-lookup"><span data-stu-id="9e134-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="9e134-431">Kured surveille les nœuds Linux qui nécessitent un redémarrage, puis gère automatiquement la replanification des pods en cours d’exécution et le processus de redémarrage des nœuds.</span><span class="sxs-lookup"><span data-stu-id="9e134-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="9e134-432">Points à prendre en considération pour le déploiement (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="9e134-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="9e134-433">Azure et Azure Stack Hub exposent les mêmes API REST Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="9e134-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="9e134-434">Vous faites appel à ces API comme pour tout autre cloud (Azure, Azure China 21Vianet, Azure Government).</span><span class="sxs-lookup"><span data-stu-id="9e134-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="9e134-435">Il peut y avoir des différences dans les versions des API entre les clouds, et Azure Stack Hub fournit seulement un sous-ensemble de services.</span><span class="sxs-lookup"><span data-stu-id="9e134-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="9e134-436">L’URI du point de terminaison de gestion est également différent pour chaque cloud et pour chaque instance Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="9e134-437">Hormis les subtiles différences mentionnées, les API REST Azure Resource Manager offrent un moyen cohérent pour interagir avec Azure et Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="9e134-438">Le même ensemble d’outils peut être utilisé ici comme il serait utilisé avec n’importe quel autre cloud Azure.</span><span class="sxs-lookup"><span data-stu-id="9e134-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="9e134-439">Vous pouvez utiliser Azure DevOps, des outils comme Jenkins ou PowerShell pour déployer et orchestrer des services sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="9e134-440">**Considérations**</span><span class="sxs-lookup"><span data-stu-id="9e134-440">**Considerations**</span></span>

<span data-ttu-id="9e134-441">Une des principales différences concernant les déploiements d’Azure Stack Hub est la question de l’accessibilité à Internet.</span><span class="sxs-lookup"><span data-stu-id="9e134-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="9e134-442">L’accessibilité à Internet détermine s’il faut sélectionner un agent de build hébergé par Microsoft ou auto-hébergé pour vos travaux CI/CD.</span><span class="sxs-lookup"><span data-stu-id="9e134-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="9e134-443">Un agent auto-hébergé peut s’exécuter sur Azure Stack Hub (en tant que machine virtuelle IaaS) ou dans le sous-réseau d’un réseau qui peut accéder à Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="9e134-444">Pour plus d’informations sur les différences, consultez [Agents Azure Pipelines](/azure/devops/pipelines/agents/agents).</span><span class="sxs-lookup"><span data-stu-id="9e134-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="9e134-445">L’image suivante vous aide à déterminer si vous avez besoin d’un agent de build auto-hébergé ou hébergé par Microsoft :</span><span class="sxs-lookup"><span data-stu-id="9e134-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Agents de build auto-hébergés : Oui ou Non](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="9e134-447">Les points de terminaison de gestion d’Azure Stack Hub sont-ils accessibles via Internet ?</span><span class="sxs-lookup"><span data-stu-id="9e134-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="9e134-448">Oui : Nous pouvons utiliser Azure Pipelines avec des agents hébergés par Microsoft pour se connecter à Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="9e134-449">Non : Nous avons besoin d’agents auto-hébergés qui peuvent se connecter aux points de terminaison de gestion d’Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="9e134-450">Notre cluster Kubernetes est-il accessible via Internet ?</span><span class="sxs-lookup"><span data-stu-id="9e134-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="9e134-451">Oui : Nous pouvons utiliser Azure Pipelines avec des agents hébergés par Microsoft pour interagir directement avec le point de terminaison de l’API Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="9e134-452">Non : Nous avons besoin d’agents auto-hébergés qui peuvent se connecter au point de terminaison de l’API du cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="9e134-453">Dans les scénarios où les points de terminaison de gestion d’Azure Stack Hub et l’API Kubernetes sont accessibles via Internet, le déploiement peut utiliser un agent hébergé par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9e134-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="9e134-454">Ce déploiement va se traduire par une architecture d’application comme celle-ci :</span><span class="sxs-lookup"><span data-stu-id="9e134-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="9e134-455">[![Vue d’ensemble de l’architecture publique](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="9e134-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="9e134-456">Si les points de terminaison Azure Resource Manager, l’API Kubernetes, ou les deux, ne sont pas directement accessibles via Internet, nous pouvons tirer parti d’un agent de build auto-hébergé pour exécuter les étapes du pipeline.</span><span class="sxs-lookup"><span data-stu-id="9e134-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="9e134-457">Cette conception nécessite moins de connectivité et peut être déployée avec seulement une connectivité réseau locale aux points de terminaison Azure Resource Manager et à l’API Kubernetes :</span><span class="sxs-lookup"><span data-stu-id="9e134-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="9e134-458">[![Vue d'ensemble de l'architecture locale](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="9e134-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="9e134-459">**Qu’en est-il des scénarios déconnectés ?**</span><span class="sxs-lookup"><span data-stu-id="9e134-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="9e134-460">Dans les scénarios où Azure Stack Hub ou Kubernetes, ou les deux, n’ont pas de points de terminaison de gestion accessibles sur Internet, il est toujours possible d’utiliser Azure DevOps pour vos déploiements.</span><span class="sxs-lookup"><span data-stu-id="9e134-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="9e134-461">Vous pouvez utiliser un pool d’agents auto-hébergés (qui est un agent DevOps s’exécutant localement ou sur Azure Stack Hub lui-même) ou un serveur Azure DevOps Server local entièrement auto-hébergé.</span><span class="sxs-lookup"><span data-stu-id="9e134-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="9e134-462">L’agent auto-hébergé a seulement besoin d’une connectivité Internet HTTPS (TCP/443) sortante.</span><span class="sxs-lookup"><span data-stu-id="9e134-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="9e134-463">Le modèle peut utiliser un cluster Kubernetes (déployé et orchestrée avec le moteur AKS) sur chaque instance Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="9e134-464">Il inclut une application composée d’un front-end, d’un niveau intermédiaire, de services back-ends (par exemple MongoDB) et d’un contrôleur d’entrée basé sur Nginx.</span><span class="sxs-lookup"><span data-stu-id="9e134-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="9e134-465">Au lieu d’utiliser une base de données hébergée sur le cluster Kubernetes, vous pouvez tirer parti de « magasins de données externes ».</span><span class="sxs-lookup"><span data-stu-id="9e134-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="9e134-466">Les options de base de données incluent MySQL, SQL Server ou tout type de base de données hébergé en dehors d’Azure Stack Hub ou dans IaaS.</span><span class="sxs-lookup"><span data-stu-id="9e134-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="9e134-467">Les configurations comme celle-ci ne sont pas abordées ici.</span><span class="sxs-lookup"><span data-stu-id="9e134-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="9e134-468">Solutions de partenaires</span><span class="sxs-lookup"><span data-stu-id="9e134-468">Partner solutions</span></span>

<span data-ttu-id="9e134-469">Il existe des solutions de partenaires Microsoft qui peuvent étendre les fonctionnalités d’Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="9e134-470">Ces solutions se sont avérées utiles pour les déploiements d’applications s’exécutant sur des clusters Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="9e134-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="9e134-471">Solutions de stockage et de données</span><span class="sxs-lookup"><span data-stu-id="9e134-471">Storage and data solutions</span></span>

<span data-ttu-id="9e134-472">Comme décrit dans [Considérations relatives au stockage et aux données](#data-and-storage-considerations), Azure Stack Hub n’a actuellement pas de solution native pour répliquer le stockage sur plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="9e134-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="9e134-473">Contrairement à Azure, la fonctionnalité de réplication du stockage sur plusieurs régions n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="9e134-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="9e134-474">Dans Azure Stack Hub, chaque instance est son propre cloud distinct.</span><span class="sxs-lookup"><span data-stu-id="9e134-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="9e134-475">Cependant, des solutions sont disponibles auprès de partenaires Microsoft qui permettent la réplication du stockage sur les instances Azure Stack Hub et Azure.</span><span class="sxs-lookup"><span data-stu-id="9e134-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="9e134-476">**SCALITY**</span><span class="sxs-lookup"><span data-stu-id="9e134-476">**SCALITY**</span></span>

<span data-ttu-id="9e134-477">[Scality](https://www.scality.com/) offre un stockage à l’échelle du web qui est utilisé par des entreprises du numérique depuis 2009.</span><span class="sxs-lookup"><span data-stu-id="9e134-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="9e134-478">Scality RING, notre stockage défini par logiciel, transforme des serveurs x86 en un pool de stockage illimité pour n’importe quel type de données (fichier et objet) à l’échelle du pétaoctets.</span><span class="sxs-lookup"><span data-stu-id="9e134-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="9e134-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="9e134-479">**CLOUDIAN**</span></span>

<span data-ttu-id="9e134-480">[Cloudian](https://www.cloudian.com/) simplifie le stockage d’entreprise avec un stockage évolutif sans limite qui regroupe des ensembles de données massifs en un environnement unique et facile à gérer.</span><span class="sxs-lookup"><span data-stu-id="9e134-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9e134-481">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9e134-481">Next steps</span></span>

<span data-ttu-id="9e134-482">Pour plus d’informations sur les sujets abordés dans cet article :</span><span class="sxs-lookup"><span data-stu-id="9e134-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="9e134-483">[Mise à l’échelle entre clouds](pattern-cross-cloud-scale.md) et [Modèles d’applications géodistribuées](pattern-geo-distributed.md) dans Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="9e134-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="9e134-484">[Architecture des microservices sur AKS (Azure Kubernetes Service)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="9e134-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="9e134-485">Quand vous êtes prêt à tester l’exemple de solution, poursuivez avec le [Guide de déploiement du cluster Kubernetes à haute disponibilité](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="9e134-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="9e134-486">Ce guide de déploiement fournit des instructions pas à pas sur le déploiement et sur le test de ses composants.</span><span class="sxs-lookup"><span data-stu-id="9e134-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>